# 数据库

_为了解决内存和磁盘之间的存储格式不一致的问题_

> 持久化地存储数据，将数据保存到磁盘中

> 备份和恢复数据

> 快速地读取数据

> 权限控制

## mysql 驱动程序

> 通过 createConnection 或 createPool 创建一个数据库连接，调用 end 方法断开，一般建议使用 createPool 创建，会得到一个资源池，更好地帮我们管理查询出来的数据结果，也可以设置数量等，详情见官网

> 创建的时候，可以定义 multipleStatements 为 true，表示可以查询多条 sql 语句；如果要使用多条 sql 语句的话，记得通过（;）分号，表示一条语句的结束

1）驱动程序是连接内存和其它存储介质的桥梁

2）mysql 驱动程序是连接内存和 mysql 数据的桥梁

3）mysql 驱动程序通常使用：mysql、mysql2（推荐，原名是 mysql-native）

> 提供了 query 和 execute 查询函数

1）使用 query 查询函数，可能会造成 sql 注入攻击

2）execute 则可以避免这一点，运用了 sql 的变量，在执行查询前会先进行预编译，判断可以执行后，才会执行查询函数，并返回结果

> 第一个参数为 sql 查询语法，第二个参数为 node 的回调函数类型，第一个参数为错误信息，第二个参数为返回结果

_mysql2 这个库也很贴心地提供了 promise 语法，更好的利于我们操作数据_

> 如果要通过传递参数的形式，查询数据库的数据，使用 execute 更好

> 要替换的参数位置，在 sql 查询语句中使用（ ? ），在调用 execute 时，接收两个参数，第一个参数为 sql 查询语句，第二个参数为传递的参数名，是一个数组

```yaml 模糊查询 like
like '%?%' // 这里的 ? 会被当做普通的字符串 ? 来使用，
不是我们预期的结果，可以使用 concat 关键字拼接
like concat('%', ?, '%')
```

### sql 注入

> 用户通过注入 sql 语句到最终查询结果中，导致了整个 sql 与预期的行为不符

> mysql 支持变量，变量的内容不作为任何的 sql 关键字
